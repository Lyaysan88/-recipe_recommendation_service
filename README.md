Проект «Прототип рекомендательного сервиса рецептов»

вывод прогноза и рейтинга с оценкой (невкусное, нормальное, вкусное) для блюда, которое можно приготовить на основе списка переданных ингредиентов
вывод информации о питательных веществах (белках, жирах, натрии и т. д.) продуктов из списка, а также их объем в процентах от суточной нормы потребления
вывод трех рецептов блюд, в которых используются продукты из списка (с минимальным количеством доп. ингредиентов), с указанием их оценки и ссылок
вывод меню дня из трех случайных рецептов с наивысшими оценками, подходящими для завтрака, обеда и ужина, с указанием ингредиентов, нутриентов и ссылок


Этапы работы:

Подготовка данных, включающая фильтрацию строк и столбцов, получения новых данных с помощью API и парсинга, построение новых таблиц, необходимых для работы классов.
Построение, обучение различных регрессионных моделей МО с различными параметрами, вычисление оценки RMSE для лучших из них на тестовых данных.
Построение, обучение различных моделей классификации МО (для 6 и 3 классов) с различными параметрами, вычисление оценки accuracy для лучших из них на тестовых данных.
Выбор новой метрики оценки моделей. Построение, обучение различных моделей классификации МО с различными параметрами, вычисление новой метрики для лучших из них на тестовых данных. Выбор и сохранение лучшей модели.
Написание классов и методов, необходимых для работы обязательной и бонусной части основной программы. Написание основной программы.
Тестирование приложения на различных наборах ввода, выявление ошибок и доработка алгоритмов.


Подготовка данных:

Был предоставлен датасет более 20 тыс. рецептов с 680 признаками, содержащий большое количество дубликатов, лишних столбцов, пустых значений и тп. Используя его и данные из сторонних источников, я создала 6 датасетов:

df – удалены столбцы, не являющиеся ингредиентами или рейтингом, удалены дублирующие и пустые строки, для ряда моделей столбец рейтинга приведен к нужному виду.
nutrients – на основе таблицы с нужными нутриентами и их суточной нормой с помощью API были получены абсолютные показатели нутриентов для каждого ингредиента из df. Абсолютные значения приведены к процентам дневной нормы.
recipes – удалены лишние столбцы, удалены дубликаты, для каждого рецепта спарсена ссылка на него на сайте www.epicurious.com, если такой ссылки нет, то первая ссылка из запроса названия рецепта в www.google.com
breakfast, lunch, dinner – созданы на основе recipes, фильтрацией по названию приема пищи, наличию рейтинга 5 и отсутствию пустых значений КБЖУ. Абсолютные значения столбцов КБЖУ приведены к процентам дневной нормы.


Машинное обучение:

Данные были разделены случайно со стратификацией по таргету на обучающую и тестовую выборки в соотношении 0.8 к 0.2
С помощью GridSearchCV и кросс-валидации были проанализированы следующие регрессионные модели и ансамбли моделей с различными параметрами: LinearRegression, SVR, DecisionTreeRegressor, RandomForestRegressor, GradientBoostingRegressor, VotingRegressor, BaggingRegressor, StackingRegressor. Для каждого типа модели с лучшими параметрами на кросс-валидации были вычислены значения метрики RMSE на тестовой выборке. Лучшей регрессионной моделью стала SVR с параметрами {'C': 1, 'gamma': 'scale', 'kernel': 'rbf'}, RMSE = 1.1875, что на 0.1 меньше значения RMSE наивного регрессора.
Таргет был приведен к 6 классам. С помощью GridSearchCV и кросс-валидации были проанализированы следующие классификационные модели и ансамбли моделей с различными параметрами: LogisticRegression, SVС, DecisionTreeClassifier, RandomForestClassifier, GradientBoostingClassifier, VotingClassifier, BaggingClassifier, StackingClassifier. Для каждого типа модели с лучшими параметрами на кросс-валидации были вычислены значения метрики accuracy на тестовой выборке. Лучшей классификационной моделью стала SVC с параметрами {'C': 1, 'gamma': 'scale', 'kernel': 'rbf'}, accuracy = 0.6707, что на 0.005 больше значения accuracy наивного классификатора.
Таргет был приведен к 3 классам. С помощью GridSearchCV и кросс-валидации были проанализированы следующие классификационные модели и ансамбли моделей с различными параметрами: LogisticRegression, SVС, DecisionTreeClassifier, RandomForestClassifier, GradientBoostingClassifier, VotingClassifier, BaggingClassifier, StackingClassifier. Для каждого типа модели с лучшими параметрами на кросс-валидации были вычислены значения метрики accuracy на тестовой выборке. Лучшей классификационной моделью стал GradientBoostingClassifier с параметрами {'max_depth': 2, 'n_estimators': 90}, accuracy = 0.799, что на 0.004 больше значения accuracy наивного классификатора.
Новой метрикой была выбрана precision по классу great, так как классифицикация плохого рецепта как хорошего имеет худший эффект, что классифицикация хорошего рецепта как плохого.
Все указанные в п.4 модели были проанализированны с новой метрикой. Лучшую метрику precision на тестовой части (0.7053, что на 0.0727 лучше наивного) показал GradientBoostingClassifier с параметрами max_depth=5, n_estimators=80. Он и был выбран моделью для использования в основной программе.

Классы и основная программа:

Forecast – класс прогноза оценки рецепта по списку ингредиентов, со следующими методами: init - принимает строку с ингредиентами указанными через запятую, приводит к списку ингредиентов в удобном для анализа виде (все буквы прописные, лишние пробелы удалены). Создает три атрибута список всех ингредиентов (list_of_ingredients), список ингредиентов, присутствующих в базе данных (known_ingredients), список ингредиентов, отсутствующих в базе данных(unknown_ingredients), последние два строятся по колонкам nutrients.csv. preprocess – выдает вектор в виде DataFrame с единицами в колонках из known_ingredients и нулями во всех остальных. predict_rating_category – загружает модель МО из best_model.joblib и по результату preprocess с помощью метода predict делает предсказание в виде двух значений: оценки (‘bad’, ‘so-so’, ‘great’) и текстового описания.
NutritionFacts – класс выдающий показатели нутриентов по списку ингредиентов, со следующими методами: init - аналогичен init класса Forecast retrieve – выдает DataFrame с дневными процентными нормами по 32 нутриентам(nutrients.csv) и known_ingredients. filter – принимает n - количество нутриентов. По результату retrieve строит текст вывода n – самых больших в проценте от дневной нормы нутриентов для каждого продукта из known_ingredients.
SimilarRecipes – рекомендации похожих рецептов с дополнительной информацией: init - аналогичен init класса Forecast. find_all – из recipes.csv отбирает только строки содержащие все ингредиенты из known_ingredients и выдает список индексов этих строк, если таких строк нет, то None. top_similar – принимает n - количество рецептов. Строит текст вывода информации о рецептах в количестве n или менее, которые соответсвуют следующим условиям: отсортированы по количеству дополнительных ингредиетнов, имеют индексы – результат find_all, имеют менее 5 дополнительных ингредиентов. Если таких рецептов не найдено или n < 1, то результатом метода будет None.
print_daily_menu - метод выводящий три случайных рецепта меню дня и подробную информацию о них. Использует breakfast.csv, lunch.csv, dinner.csv.
Основная программа – запрашивает список ингредиентов либо слово bonus, создает экземпрляры классов Forecast(s), NutritionFacts(), SimilarRecipes(). Если в списке присутствуют ингредиенты, которых нет в базе, то выводится сообщение об этом, анализ проводится только по оставшемся ингредиентам. Если в списке нет ни одного ингредиента из базы, выводится соответствующее сообщение, анализ не проводится. Программа печатает результаты Forecast.predict_rating_category, NutritionFacts.filter(5), SimilarRecipes.top_similar(3) (если результат None, то выводится соответствующее сообщение). При вводе bonus, выводится подробная информация о трех рецептах(завтраке, обеде и ужине).


Возможные улучшения проекта:

Построение на основе консольного приложения TelegramBot либо Web-приложения
Улучшение метрики модели по средствам добавления «плохих» сочетаний продуктов
Добавление дополнительного функционала, например, поиска продуктов и рецептов по нутриентам и витаминам

Security
Status
Docs
Contact GitHub
Pricing
API
